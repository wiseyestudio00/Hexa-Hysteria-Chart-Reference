# 譜面格式（高級）
這裡列出了比較難操作，或是需要對遊戲更深的理解才能使用的特殊譜面格式。

這些並不是非得要學會不可的譜面格式。但是如果您學會了他們，將可以為舞台帶來更多不可思議的效果。

建議至少寫出一兩份譜之後，再來操作這些行動。

- [重組舞台](#重組舞台)
- [加拍子](#加拍子)
- [禁止輸入](#禁止輸入)

## 重組舞台
你可以改變舞台的形狀。
這並不是指旋轉或是改變大小，而是真的改變舞台的構成。

正方形舞台
![Square](https://github.com/wiseyestudio00/Hexa-Hysteria-Chart-Reference/blob/main/pics/2.Reference/Square.png)

### 格式
```
a changestage 新舞台名稱 開始拍 持續拍 算式模式
```

[預設的舞台名稱列表](https://docs.google.com/document/d/1qoytsVbdQ8EUK1CnRc-Ril_KJwVlg2gzXNWUGEFYj_g/edit?usp=sharing)

### 示範
```
a changestage square 10 3 easeinoutsine
```
將舞台轉換成sqauare形狀，開始於第十拍，持續三拍完成動作，使用easeinoutsine

## 自訂舞台組合
除了已經預設的舞台列表，你也可以自訂舞台的形狀。

這會需要你去手動定義每一個新的舞台構成，包含每一個舞台的**位置**以及**角度**。

每一個**位置**以及**角度**都是由一個三量相座標來定位的，也就是(x, y, z)

格式如下：
```
define stageposition Stage_Position_Name 右上X座標,右上Y座標,右上Z座標 右上X角度,右上Y角度,右上Z角度 右中...右下...左下...左中...左上X座標,左上Y座標,左上Z座標 左上X角度,左上Y角度,左上Z角度
```
比如說，classichexagon的構成即為
```
define stageposition classichexagon 1.35,2.35,0 0,0,240 2.7,0,0 0,0,180 1.35,-2.35,0 0,0,120 -1.35,-2.35,0 0,0,60 -2.7,0,0 0,0,0 -1.35,2.35,0 0,0,300
```

用圖表列出來就是

位置 | 座標 | 角度
------------ | ------------- | -------------
右上 | 1.35,2.35,0 | 0,0,240
右中 | 2.7,0,0 | 0,0,180
右下 | 1.35,-2.35,0 | 0,0,120
左下 | -1.35,-2.35,0 | 0,0,60
左中 | -2.7,0,0 | 0,0,0
左上 | -1.35,2.35,0 | 0,0,300

（Define不需要在譜面上的特定位置。如果你想要的話，可以全部擺在譜面的最上方或最下方來保持譜面整潔。）

好，我知道你在想什麼：這也未免太複雜了而且太難用了，就算這個功能很厲害，我也不會去用他。

我也是這麼認為的，所以我設計了個小幫手來協助這項作業。

![New Dev Menu](https://github.com/wiseyestudio00/Hexa-Hysteria-Chart-Reference/blob/main/pics/2.Reference/DevMenu.png)

在開發者介面，點選這個按鈕，就會進入舞台設計畫面

![View Stage Position](https://github.com/wiseyestudio00/Hexa-Hysteria-Chart-Reference/blob/main/pics/2.Reference/ViewStage.png)

這邊講解一下功能。

項目 | 功能
------------ | ------------- |
箭頭 | 返回
左邊的物件列表 | 可以選取目前想要調整的位置或角度的物件。包含六條軌道以及相機。
Position | 可以調整目前被選取的物件的座標
Angle | 可以調整目前被選取的物件的角度
Reset | 重設目前被選取的物件
Copy | 把目前的舞台設置依照上述的格式黏貼到你的剪貼簿上。你就可以用複製貼上的方式來使用這個舞台設計了

我知道，如果目前你想要同時進行設計舞台以及寫譜的動作，可能必須要同時有兩台以上的裝置才會比較方便。我之後會想辦法讓這個功能變得更便捷一些的。

### 詳細解說
#### 1. 為什麼旋轉舞台時不也直接用重組舞台行動就好了？為什麼要轉攝影機？
重組舞台是非常跳脫框架的行動。
事實上，我對於這個行動稍稍地感到不安，因為他打破了「六角形」的這個基本規則。

我不希望這是一個經常被使用的行動。他只能被使用在非常特殊的譜面中。

反之，我希望譜師是在有著100%的自信，明確地知道自己正在做什麼的情況下，才使用這個行動

擺弄攝影機，雖然也是比較特殊的行動，但他並沒有打破任何的基本規則。
如果只是想用放大/縮小，旋轉舞台等等的效果，請盡量使用移動攝影機位置。

#### 2. 重組舞台時，可以保證所有的螢幕都能看到軌道嗎？（也就是說，平板或是手機都能看到同樣的效果？）
可以。**平板跟手機看到的舞台是一樣的**

#### 3. 重組的途中，可以正常打擊嗎？
理論上可以。但是有沒有辦法做到手感良好的打擊則需要譜師的技巧了

#### 4. 如果說舞台有重疊的情況，會發生什麼事呢？
在上方的舞台會被點擊到，下方的則不會。

### 注意事項
不在鏡頭內的舞台，並不是消失了，只是在鏡頭外而已

**如果攝影機轉到奇怪的角度，還是有可能看到**

如果真的不想被看到，請搭配 `舞台換色` 行動做使用（將不想要被看到的舞台變透明）

## 加拍子
```
a addbeat note/action 99 1 100-104 3 easeinoutsine
```
在第99拍的時候，花一拍的時間，把在開始拍在第100到104拍之間的**音符/舞台行動**的**開始拍** +3 拍

這是一個強大而且複雜的舞台行動，請聽我慢慢解釋。

只要正確使用這個效果，就能製造出**倒退**，**瞬移**，**暫停**⋯⋯或是幾乎任何跟**時間相關的效果**。

想要正確使用這個效果前，我們必須先知道音符與舞台行動的運作方式。

### 運作方式解說
首先，先看看**音符**的位置的計算方式。

音符**出現的時機**，則跟玩家的**音符速度設定**有關。

音符會在他的**開始拍**抵達的時候，跟**打擊器**的位置重疊。

為什麼？我們來設想以下情況。

現在有一顆在**99拍要被打到的音符**

玩家設定的提早拍數 | 解說
------------ | -------------
2拍 | 音符會在**97拍**的時候出現在起點，並且花**兩拍**的時間從起點抵達打擊線
4拍 | 音符會在**95拍**出現，並且花**四拍**的時間抵達打擊線

自然，提早四拍出現的音符就會比提早兩拍的音符**慢**，即使他們抵達打擊線的拍子是一樣的。

也就是說，音符在軌道上的相對位置，等於`音符的打擊拍 - 現在實際的拍數 / 玩家設定的提早出現拍數`

什麼意思？如果搞不懂的話，做一個思想實驗吧

### 思想實驗時間（1）
現在有一個打擊拍在100拍的音符，玩家的提早拍為2拍

現在的拍數 | 音符在軌道上的位置 | 解說
------------ | ------------- | -------------
99 | `(100 - 98) / 2 = 1 (100%)` | 音符在軌道的起點
98.5 | `(100 - 98.5) / 2 = 0.75 (75%)` | 音符在軌道的1/4處
99 | `(100 - 99) / 2 = 0.5 (50%)` | 音符在軌道的1/2處，也就是中間
99.1 | `(100 - 99.1) / 2 = 0.48 (48%)` | 音符在軌道的52%處
99.5 | `100 - 99.5 / 2 = 0.25 (25%)` | 音符在軌道的3/4處
100 | `101 - 101 / 2 = 0` | 音符與打擊線重疊了。

現在，另一個思想實驗
### 思想實驗時間（2）
現在，我們假設，現在一樣有一個打擊拍在100拍的音符，玩家的提早拍一樣為2拍。**但是，在第99拍的時候，我們說「花一拍的時間，讓打擊拍在100拍的音符加上一拍（變成101拍）」**

這個時候，會發生什麼事呢？

音符會**暫停在軌道上**。

如果想不明白的話，我們再來做個思想實驗試試看。

玩家設定提早拍 = 2，100拍要被打到的音符。在第99拍的時候，用`a addbeat note 99 1 100-100 1 linear`

現在的拍數 | 音符在軌道上的位置 | 解說
------------ | ------------- | -------------
99 | `(100 - 98) / 2 = 1 (100%)` | 音符在軌道的起點
98.5 | `(100 - 98.5) / 2 = 0.75 (75%)` | 音符在軌道的1/4處
99 | `(100 - 99) / 2 = 0.5 (50%)` | 音符在軌道的1/2處，也就是中間。這個時候，`a addbeat note 99 1 100-100 1 linear`開始生效了
99.1 | `(100.1(<舞台行動給他加上的拍子) - 99.1) / 2 = 0.5 (50%)` | 為什麼這邊的音符拍數變成100.1了呢？因為這個時候舞台行動正在**花一拍給那個音符加上一拍**，現在正進行到**0.1拍的進度**，因此那個音符被加上了**0.1拍**，也就是100.1拍。**音符依然在軌道的一半位置，沒有移動**
99.5 | `100.5 - 99.5 / 2 = 0.5 (50%)` | 依然是一半的位置，依然沒有移動
100 | `101 - 100 / 2 = 0.5 (50%)` | 這個時候，舞台行動的效果已經結束了
100.1 | `101 - 100.1 / 2 = 0.48 (48%)` | 音符在軌道上48%的位置，更靠近打擊線了。音符重新開始移動。

所以，`a addbeat note 99 1 100-100 1 linear`的意思其實是，**在第99拍的時候，讓打擊拍在100拍到100拍的音符，讓他們暫停一拍（打擊點變成101拍）**

相信到這裏，您應該開始慢慢理解到這個行動的強大之處了。

這邊簡單列舉幾個例子

行動 | 解說
------------ | -------------
`a addbeat note 99 0 100-100 1 linear` | 在第99拍的時候，讓打擊拍在100拍到100拍的音符，讓他們瞬間退後一拍的距離
`a addbeat note 99 0 100-100 -1 linear` | 在第99拍的時候，讓打擊拍在100拍到100拍的音符，讓他們瞬間前進一拍的距離
`a addbeat note 99 2 100-102 1 linear` | 在第99拍的時候，讓打擊拍在100拍到102拍的音符，變慢兩拍
`a addbeat note 99 2 100-102 2 easeinoutsine` | 在第99拍的時候，讓打擊拍在100到102拍的音符，向後「彈」兩拍（因為你使用了easinoutsine）

諸如此類，有非常多的組合可以讓你使用。

### 限制
這是一個很特殊的舞台行動，所以這裏特別講解一下：
- 這個行動不能被自己影響！
  - `a addbeat note 99 0 99-99 1 linear`類似這樣的行動，是被禁止的
    - 如果這個行動本身開始的拍子被包含在影響範圍內，會導致無法被定義的情況，請不要這樣做
  - 最好也不用讓addbeat去影響另一個addbeat
  - 正在被影響的音符/行動，不能被另一個addbeat影響
- 在這期間，音符依然可以被打到
  - 如果你想確保音符不能被打到，那就用`a disableinput`來禁止玩家的輸入
- 長音符的長度不會改變
  - 一個打擊拍在99拍，結束拍在102拍的的長音符，再被加了三拍之後，會變成開始拍在102拍，結束拍在105拍的長音符
- 這個行動所影響的音符/舞台行動的開始拍會完全變動
```
//這裏有個102拍的短音符，我想要影響他兩次
n short rc 102
//這裡影響了一次，101拍的時候，上面這個音符的拍子已經變成105拍了（102+3)
a addbeat note/action 100 1 100-103 3 easeinoutsine
//這裏，我想再影響剛剛那個音符。所以我必須包含105拍，因為他的拍子已經不是102拍，而是105拍了
a addbeat note/action 102 1 105-106 3 easeinoutsine
```
- 這個行動沒辦法讓已經執行過的音符/舞台行動「死而復生」
  - 已經結束的音符或舞台行動不會重新「再出現」。這個舞台行動只能影響他「之後的舞台行動」跟「他被執行時，已經在被執行而且還沒有結束的舞台行動」

## 禁止輸入
```
a disableinput 100 1
```
在第一百拍的時候，禁止打擊一拍，然後在第101拍的時候，重新准許打擊。

這個主要是在特殊效果演出時，不要讓玩家誤觸音符而做的行動。

如果在特殊演出時，你依然想讓玩家打到音符，那就不需要使用這個行動。

注意，不管怎麼樣，你都應該確保在音符應該要被打到之前，讓玩家可以打到音符

注意，這會導致自動打擊在禁止打擊的期間也失效


## 更換bpm
tbc...
